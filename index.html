<!DOCTYPE <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>MineSweeper</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        .menu_margin { margin-bottom: 5px; } /* force margins around the menu title */
		.menu_title { font-family: helvetica; font-size: 12px; }
		.menu_dropdown { position:absolute; visibility: hidden; width:150px; top:30px; z-index:5; }
		a { text-decoration: none; cursor: default; } /* Remove underline from menus */
		a:link, a:visited, a:active { color: #000; }
		a:hover { color: #00C; }
		.menu_item { font-family: helvetica; font-size: 12px; }
		.menu_divider { font-family: helvetica; font-size: 2px; }
    </style>
    <script type="text/javascript" src="main.js"></script>
</head>
<body bgcolor="#C0C0C0">

<!-- Menu Bar -->
<table width="150" border="0" cellspacing="0" cellpadding="0"  class="menu_margin">
    <tr>
        <td width="43" class="menu_title"><a onclick= "clickMenu('divMenuGame')">Game</a></td>
    </tr>
</table>
<!-- Game Menu -->
<div id="divMenuGame" class="menu_dropdown" style="left:10px;", >
    <table border="1" bgcolor="#C0C0C0" class="dropdown">
        <tr>
            <td class="menu_item" nowrap="nowrap">
                <img src="images/notchecked.gif" width="10" height="10" name="New"/>
                <a onclick= "newGame('default')">New &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; F2</a><br>
                <img src="images/notchecked.gif" width="10" height="10" name="Pause"/>
                <a onclick=>Pause&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P</a><br>
                <hr>
                <img src="images/checked.gif" width="10" height="10" name="Beginner" id = "beginner">
                <a onclick= "menuClicked('beginner')">Beginner</a><br>
                <img src="images/notchecked.gif" width="10" height="10" name="Intermediate" id = "intermediate">
                <a onclick= "menuClicked('intermediate')">Intermediate</a><br>
                <img src="images/notchecked.gif" width="10" height="10" name="Expert" id = "expert">
                <a onclick= "menuClicked('expert')">Expert</a><br>
                <img src="images/notchecked.gif" width="10" height="10" name="Custom" id = "gamecustom">
                <a onclick="menuClicked('gamecustom')">Custom</a><br>
                <hr>
                <img src="images/notchecked.gif" width="10" height="10" name="Exit" >
                <a onclick= >Exit</a><br>
            </td>
        </tr>
    </table>
</div>
<!-- functions for the drop down game menu -->
<script>
    //bool to help the menu open and close        
    let isOpen = false;
    function clickMenu(thisMenu)
    {
        // if the menu is closed open on click
        if(!isOpen)
        {
            document.getElementById(thisMenu).style.visibility ="visible";
            isOpen = true;
        }
        //if the menu is open close on click
        else{
            document.getElementById(thisMenu).style.visibility = "hidden"
            isOpen = false;
        }
    }

    function closeMenu()
    {
        document.getElementById('divMenuGame').style.visibility = 'hidden';
        isOpen = false;
    }

    function newGame()
    {
        menuClicked(difficulty);
    }

    function setChecks(gameMode)
    {
        // reset all check marks
        document.Beginner.src = "images/notchecked.gif";
        document.Intermediate.src = "images/notchecked.gif";
        document.Expert.src = "images/notchecked.gif";
        document.Custom.src = "images/notchecked.gif";
        //set the new check mark on clicked game mode
        document.getElementById(gameMode).src = "images/checked.gif";
    }
</script>

    <!-- Game Board -->
<script type='text/javascript'>


// board variables
var difficulty = 'default';
var mines;
var rows; 
var columns;
var remaining = mines;
var tile=[];
var border = [];
var board=[];
var revealed=0;
function menuClicked(gameMode)
{
    //make sure there is no current game board and destroy the current one if there is
    destroyBoard();
    //change which game mode is selected in the menu
    setChecks(gameMode);
    //change the board size based on game mode
    setDifficulty(gameMode);
    //build the game board
    build();
    //close the game menu
    closeMenu();
}

// check the coordinate of the tile
function check(x1, y1)
{
    //is the tile in the board
    if((x1>=0)&&(y1>=0)&&(x1<columns)&&(y1<rows))
    { 
        return board[x1+y1*columns];
    }
}

function setDifficulty(gameMode)
{
    difficulty = gameMode;

    if (difficulty === 'beginner' || difficulty === "default")
    {
        rows = 8;
        columns = 8;
        mines = 10;
    }
    else if( difficulty === 'intermediate')
    {
        rows = 16;
        columns = 16;
        mines = 40;
    }
    else if (difficulty === 'expert')
    {
        rows = 24;
        columns = 24;
        mines = 99;
    }
}

//build the board
function build()
        
{
    console.clear();
    //create the tiles
    for (var i=0; i < rows * columns; i++)
    {
    //create the tile image
    tile[i] = document.createElement('img');
    tile[i].src="images/blank.gif";
    tile[i].style="position:absolute; height:20px; width: 20px";
    //place the tiles
    tile[i].style.top=75+Math.floor(i/columns)*20;
    tile[i].style.left=50+i%columns*20;
    //add ability to be clicked
    //tile[i].addEventListener('mousedown', click);
    tile[i].id=i;
    document.body.appendChild(tile[i]);
    console.log(tile[i].x +' , ' + tile[i].y);
    }

    // Place the mines
    var placed=0;
    do
    {
        // pick random tile
        i = Math.floor(Math.random()*columns*rows);

        // check for already placed mine
        if (board[i]!='mine')
            {
            // set the mine
            board[i]='mine';
            placed++;
            }        
    } while (placed<mines);

    //check neighbor tiles for mines
    for(var x=0;x<columns;x++)//columns
    {
        for(y=0;y<rows+1;y++) //rows
        {
            if(check(x,y)!='mine') //if the cell is not a mine:
            {
                // the value of the cell is the sum of mines in the eight neighboring tiles:
                board[x+y*columns]= 
                ((check(x,y+1)=='mine')|0) //bottom
                +((check(x-1,y+1)=='mine')|0)//bottom left
                +((check(x+1,y+1)=='mine')|0)//bottom right
                +((check(x,y-1)=='mine')|0)//top
                +((check(x-1,y-1)=='mine')|0)//top left
                +((check(x+1,y-1)=='mine')|0)//top right
                +((check(x-1,y)=='mine')|0)//left
                +((check(x+1,y)=='mine')|0);//right
            }
        }
    }

}

function destroyBoard()
{
    if(tile.length > 0)
    {
        for(var i = 0; i < rows*columns; i++)
        {
            document.getElementById(i).remove(tile[i]);
        }
    }
    else{
        return;
    }
}

function click(event)
{
    var source = event.target;
    var id = source.id;

    if(event.which === 3)
    {
        switch(picture(id))
        {
            case 'blank' :tile[id].src = 'bombflagged.gif',remaining--;
            break;
            case 'bombflagged' :tile[id].src = 'bombquestioned.gif', remaining++;
            break;
            case 'bombquestioned' :tile[id].src = 'blank.gif';
            break;
        }
    }
}
</script>

</body>
</html>